#deployment:
#  additionalVolumes:
#  - name: nfs-traefik
#    persistentVolumeClaim:
#      claimName: nfs-traefik
#additionalVolumeMounts:
#- name: nfs-traefik
#  mountPath: /etc/traefik/acme
#  subPath: traefik


#certificatesResolvers:
#  myresolver:
#    acme:
#      email: truhponen@gmail.com
#      storage: acme.json
#      dnsChallenge:
#        provider: cloudflare
#        delayBeforeCheck: 60

# Publish and protect Traefik Dashboard with basic Auth
# Create an IngressRoute for the dashboard
ingressRoute:
  dashboard:
    enabled: true

    # Custom match rule with host domain
    matchRule: "Host(`kube-traefik.kotimme.cc`)" # && PathPrefix(`/api`) || PathPrefix(`/dashboard`)"
    entryPoints: ["websecure", "web"]
    # Add custom middlewares : authentication and redirection
    middlewares:
      - name: traefik-dashboard-auth

service:
  spec:
    loadBalancerIP: "192.168.68.250"

extraObjects:

  - apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRoleBinding
    metadata:
      name: admin-user
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: ClusterRole
      name: cluster-admin
    subjects:
    - kind: ServiceAccount
      name: admin-user
      namespace: kubernetes-dashboard

  - apiVersion: v1
    kind: ServiceAccount
    metadata:
      name: admin-user
      namespace: kubernetes-dashboard

  - apiVersion: v1
    kind: Service
    metadata:
      name: kubernetes-dashboard
      namespace: kubernetes-dashboard
      labels:
        app.kubernetes.io/component: app
        app.kubernetes.io/instance: kubernetes-dashboard
        app.kubernetes.io/name: kong
    spec:
      type: NodePort
      selector:
        app.kubernetes.io/name: kong
      ports:
        - protocol: TCP
          port: 433
          targetPort: 8443
